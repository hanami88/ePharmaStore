<div class="container-user">
  <div class="hienthi-user">
    <div class="bangchon-user">
      <div class="bangchon-user-top">
        <div class="bangchon-user-ten">
          <img src="/img/actidem.avif" alt="" />
          <h1>{{user.hoten}}</h1>
        </div>
        <img src="/img/thevang.png" alt="" />
      </div>
      <div class="bangchon-user-bot">
        <a href="/user/thongtin" class="thanhchon-user">
          <i class="fa-solid fa-user"></i>
          <div>個人情報</div>
        </a>
        <a href="/user/diachinhanhang" class="thanhchon-user">
          <i class="fa-solid fa-location-dot"></i>
          <div>配送先住所</div>
        </a>
        <a href="/user/lichsudonhang" class="thanhchon-user">
          <i class="fa-solid fa-notes-medical"></i>
          <div>注文履歴</div>
        </a>
      </div>
    </div>
     <div class="ctnthongtin-doimk">
          <div class="doimk">
            <div class="doimkcc">
              <a href="/user/thongtin"><i class="fa-solid fa-arrow-left"></i></a>
              <h1 class="title-doimk">パスワード変更</h1>
            </div>
          </div>
          <div class="thongtin-doimk">
            <form action="/user/doimatkhau" method="post" class="container-doimk">
              <div>
                アカウントのセキュリティのため、パスワードを他人と共有しないでください。8〜16文字のパスワードを作成できます
              </div>
              <label for="mkht">現在のパスワード</label>
              <input
                type="password"
                name="mkht"
                id="mkht"
                class="mkht"
                placeholder="現在のパスワード"
              />
              <label for="mkm">新しいパスワード</label>
              <input
                type="password"
                name="mkm"
                id="mkm"
                class="mkm"
                placeholder="新しいパスワード"
              />
              <label for="nlmkm">新しいパスワード（確認）</label>
              <input
                type="password"
                name="nlmkm"
                id="nlmkm"
                class="nlmkm"
                placeholder="新しいパスワード（確認）"
              />
              <div id="error-message"></div>
              <button>完了</button>
            </form>
          </div>
        </div>
      </div>
  </div>
</div>
<div class="mauxanhtieuchuan"></div>

<script>
  document.querySelector(".container-doimk").addEventListener("submit", async function (e) {
  e.preventDefault(); // Ngăn submit mặc định
  const currentPassword = document.querySelector(".mkht").value;
  const newPassword = document.querySelector(".mkm").value;
  const confirmPassword = document.querySelector(".nlmkm").value;

  const errorBox = document.getElementById("error-message");
  errorBox.textContent = "";

  // Kiểm tra mật khẩu mới có trùng nhau không
  if (newPassword !== confirmPassword) {
    errorBox.textContent = "新しいパスワードが一致しません";
    errorBox.style="color:red";
    return;
  }

  // Gửi mật khẩu hiện tại lên server để kiểm tra
  const response = await fetch("/user/kiemtramatkhau", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({ currentPassword })
  });

  const result = await response.json();

  if (!result.valid) {
    errorBox.textContent = "現在のパスワードが正しくありません";
    errorBox.style="color:red";
    return;
  }
  await fetch("/user/doimatkhau", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ newPassword })
  });
  window.location.href = "/user/thongtin";
});
</script>